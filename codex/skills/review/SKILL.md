---
name: review
description: "Critical review gate for a target PR or current working artifact. Emit structured findings and decision (`approve|request_changes`) compatible with mesh Round E."
---

# Review

## Intent
Run a critical third-party review and return a strict decision artifact.

## Modes
- `pr-comment`: review a target PR and post consolidated review output.
- `artifact-report`: review current working artifact in-memory and return report to caller context.

## Required inputs
- `--mode pr-comment|artifact-report`
- one of:
  - `--target-pr <num>`
  - `--artifact <id>`

## Output contract (required)
- `decision: approve|request_changes`
- `findings` (array)
- `summary` (1-5 lines)

For `--mode pr-comment`, post one consolidated PR comment using this template:

~~~md
Codex review note: This automated review comment was generated by the Codex reviewer.

> [!NOTE]
> Automated review by Codex.

Decision: {approve|request_changes}

Summary:
- {summary line 1}
- {summary line 2}

Findings:
1. [{severity}][{label}] {finding_id} @ {location}
   - Issue: {issue}
   - Evidence: {evidence}
   - Minimal fix: {minimal_fix}
   - Code context: fenced code block with language tag (use `{code_context}` as body)

> [!IMPORTANT]
> Use when `decision=approve`: no blocking MUST_FIX findings remain.

> [!WARNING]
> Use when `decision=request_changes`: blocking MUST_FIX findings must be resolved before merge.
~~~

Template rules:
- Keep exactly one consolidated comment per review cycle.
- Sort findings by severity (`Critical > High > Medium > Low`), then `finding_id`.
- If `findings` is empty, write `Findings: none`.
- Keep alerts concise: use `NOTE` always; include either `IMPORTANT` or `WARNING` based on `decision`.

Each finding must include:
- `finding_id`
- `location` (`file:line`)
- `severity` (`Critical|High|Medium|Low`)
- `label` (`MUST_FIX|SHOULD_CONSIDER|CAN_IGNORE`)
- `issue`
- `evidence`
- `minimal_fix`
- `code_context`

## Review focus
- bugs, spec deviations, regressions, security, performance, missing tests
- codebase convention deviations
- technical judgment and rejected alternatives rationale

## Decision handling
- `approve`: no blocking findings.
- `request_changes`: include actionable MUST_FIX first.

## Integration notes
- Called by `join` after CI green and before handoff.
- If `BEADS_DIR` is present and `MUST_FIX` exists, caller may open/update bd issues.
